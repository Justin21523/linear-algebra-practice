# Gram-Schmidt 正交化 (Gram-Schmidt Process)

> 把任意線性獨立向量組轉換為正交（或標準正交）向量組

## 1. 為什麼需要正交化？

### 正交基底的優勢

| 優勢 | 說明 |
|------|------|
| **座標計算簡單** | 投影公式簡化為 x = Qᵀb |
| **數值穩定** | 避免計算 AᵀA 的逆 |
| **QR 分解基礎** | Gram-Schmidt 產生 Q 矩陣 |
| **訊號處理** | 傅立葉分析、小波分析 |

---

## 2. Gram-Schmidt 過程

### 輸入與輸出

```
輸入：線性獨立向量組 {a₁, a₂, ..., aₙ}
輸出：正交向量組 {q₁, q₂, ..., qₙ}
```

### 核心想法

每一步，把當前向量減去其在前面向量上的投影。

### 演算法

```
Step 1: q₁ = a₁

Step 2: q₂ = a₂ - proj_{q₁}(a₂)
           = a₂ - (q₁ᵀa₂/q₁ᵀq₁) q₁

Step 3: q₃ = a₃ - proj_{q₁}(a₃) - proj_{q₂}(a₃)
           = a₃ - (q₁ᵀa₃/q₁ᵀq₁) q₁ - (q₂ᵀa₃/q₂ᵀq₂) q₂

...

Step k: qₖ = aₖ - Σᵢ₌₁ᵏ⁻¹ proj_{qᵢ}(aₖ)
```

### 標準化（可選）

若要得到**標準正交**向量組：
```
eᵢ = qᵢ / ‖qᵢ‖
```

---

## 3. 完整範例

### 給定向量

```
a₁ = [1, 1, 0]ᵀ
a₂ = [1, 0, 1]ᵀ
a₃ = [0, 1, 1]ᵀ
```

### Step 1

```
q₁ = a₁ = [1, 1, 0]ᵀ
‖q₁‖² = 1² + 1² + 0² = 2
```

### Step 2

```
q₁ᵀa₂ = 1×1 + 1×0 + 0×1 = 1

q₂ = a₂ - (q₁ᵀa₂/q₁ᵀq₁) q₁
   = [1, 0, 1]ᵀ - (1/2)[1, 1, 0]ᵀ
   = [1/2, -1/2, 1]ᵀ

‖q₂‖² = 1/4 + 1/4 + 1 = 3/2
```

### Step 3

```
q₁ᵀa₃ = 1×0 + 1×1 + 0×1 = 1
q₂ᵀa₃ = (1/2)×0 + (-1/2)×1 + 1×1 = 1/2

q₃ = a₃ - (q₁ᵀa₃/q₁ᵀq₁) q₁ - (q₂ᵀa₃/q₂ᵀq₂) q₂
   = [0, 1, 1]ᵀ - (1/2)[1, 1, 0]ᵀ - (1/2 ÷ 3/2)[1/2, -1/2, 1]ᵀ
   = [0, 1, 1]ᵀ - [1/2, 1/2, 0]ᵀ - (1/3)[1/2, -1/2, 1]ᵀ
   = [-1/2, 1/2, 1]ᵀ - [1/6, -1/6, 1/3]ᵀ
   = [-2/3, 2/3, 2/3]ᵀ
```

### 驗證正交性

```
q₁ · q₂ = 1×(1/2) + 1×(-1/2) + 0×1 = 0 ✓
q₁ · q₃ = 1×(-2/3) + 1×(2/3) + 0×(2/3) = 0 ✓
q₂ · q₃ = (1/2)×(-2/3) + (-1/2)×(2/3) + 1×(2/3) = -1/3 - 1/3 + 2/3 = 0 ✓
```

### 標準化

```
e₁ = q₁/‖q₁‖ = [1/√2, 1/√2, 0]ᵀ
e₂ = q₂/‖q₂‖ = [1/√6, -1/√6, 2/√6]ᵀ
e₃ = q₃/‖q₃‖ = [-1/√3, 1/√3, 1/√3]ᵀ
```

---

## 4. 矩陣形式

### A = QR

Gram-Schmidt 過程可以寫成矩陣分解：

```
[a₁ | a₂ | ... | aₙ] = [q₁ | q₂ | ... | qₙ] × R

其中 R 是上三角矩陣：

    [r₁₁  r₁₂  r₁₃  ...]
R = [ 0   r₂₂  r₂₃  ...]
    [ 0    0   r₃₃  ...]
    [ ⋮    ⋮    ⋮   ⋱ ]
```

### R 的元素

```
rᵢᵢ = ‖qᵢ‖           （對角線：標準化後 = 1）
rᵢⱼ = qᵢᵀaⱼ / ‖qᵢ‖   （標準正交化後）

或

rᵢᵢ = 1              （若已標準化）
rᵢⱼ = eᵢᵀaⱼ          （i < j）
```

---

## 5. 數值穩定性

### Classical Gram-Schmidt (CGS)

上述演算法是「古典」Gram-Schmidt，可能有數值不穩定問題。

### Modified Gram-Schmidt (MGS)

更穩定的版本：

```
for i = 1 to n:
    qᵢ = aᵢ
    for j = 1 to i-1:
        qᵢ = qᵢ - proj_{qⱼ}(qᵢ)  // 注意：用的是更新後的 qᵢ
    qᵢ = qᵢ / ‖qᵢ‖
```

### 差異

- CGS：先計算所有投影，再一次減去
- MGS：每減去一個投影，就更新向量

MGS 在浮點運算中更穩定。

---

## 6. 幾何意義

### 2D 範例

```
a₁ = [3, 1]ᵀ
a₂ = [2, 2]ᵀ

Step 1: q₁ = a₁ = [3, 1]ᵀ

Step 2:
  投影：proj_{q₁}(a₂) = (6+2)/(9+1) × [3, 1]ᵀ = 0.8 × [3, 1]ᵀ = [2.4, 0.8]ᵀ
  q₂ = a₂ - proj = [2, 2]ᵀ - [2.4, 0.8]ᵀ = [-0.4, 1.2]ᵀ
```

q₂ 是 a₂ 的「垂直於 q₁ 的分量」。

---

## 7. 應用

### QR 分解

Gram-Schmidt 是 QR 分解的基礎。

### 最小平方法

```
Ax = b 無解時：
A = QR
Rx̂ = Qᵀb
```

比正規方程 (AᵀA)x̂ = Aᵀb 更穩定。

### 正交多項式

Legendre 多項式、Chebyshev 多項式等都可用 Gram-Schmidt 從 {1, x, x², ...} 正交化得到。

---

## 8. 程式實作

### 本單元程式示範

| 檔案 | 內容 |
|------|------|
| `gram_schmidt_manual.py` | CGS 和 MGS 手刻實作 |
| `gram_schmidt_numpy.py` | 使用 NumPy 和 QR |

---

## 9. 考試重點

### 常見題型

1. **手算 Gram-Schmidt**
2. **驗證正交性**
3. **標準化向量**
4. **寫出 QR 分解**
5. **說明 CGS vs MGS 的差異**

### 必背公式

```
投影：proj_q(a) = (qᵀa/qᵀq) q

正交化：
  q₁ = a₁
  qₖ = aₖ - Σᵢ₌₁ᵏ⁻¹ proj_{qᵢ}(aₖ)

標準化：eᵢ = qᵢ / ‖qᵢ‖
```

### 常見錯誤

- 忘記減去**所有**前面向量的投影
- 混淆正交和標準正交
- 在 MGS 中用舊的 qᵢ 而不是更新後的

---

## 參考資料

- Strang, Chapter 4.4: Gram-Schmidt
- MIT 18.06 Lecture 17
- Trefethen & Bau, Numerical Linear Algebra, Chapter 8
