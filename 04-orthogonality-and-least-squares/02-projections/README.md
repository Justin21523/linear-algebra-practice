# 投影 (Projections)

> 投影是理解最小平方法的關鍵——把向量分解為平行和垂直兩部分

## 1. 為什麼投影很重要？

| 應用 | 說明 |
|------|------|
| **最小平方法** | 找不到精確解時，投影給出最佳近似 |
| **線性迴歸** | 把數據投影到模型空間 |
| **3D 圖學** | 把 3D 物體投影到 2D 螢幕 |
| **信號處理** | 把信號投影到頻率分量 |
| **降維** | PCA 就是投影到主成分 |

---

## 2. 投影到直線

### 問題

給定向量 b 和直線方向 a，求 b 在 a 上的投影 p。

```
      b
      ↗
     /|
    / |
   /  | e = b - p（誤差向量）
  /   |
 /    ↓
●────→●────→ a
     p = proj_a(b)
```

### 公式推導

關鍵：誤差向量 e = b - p 必須垂直於 a

```
p = x̂ a（p 在 a 方向上）

e ⊥ a
⟹ aᵀ(b - x̂a) = 0
⟹ aᵀb - x̂(aᵀa) = 0
⟹ x̂ = (aᵀb)/(aᵀa)
```

### 投影公式

```
投影向量：p = proj_a(b) = (aᵀb/aᵀa) a

投影係數：x̂ = (aᵀb)/(aᵀa)

投影矩陣：P = aaᵀ/(aᵀa)
         p = Pb
```

### 例子

```
a = [1, 1]ᵀ
b = [2, 0]ᵀ

x̂ = (aᵀb)/(aᵀa) = (1×2 + 1×0)/(1² + 1²) = 2/2 = 1

p = 1 × [1, 1]ᵀ = [1, 1]ᵀ

驗證：e = b - p = [1, -1]ᵀ
      e · a = 1×1 + (-1)×1 = 0 ✓
```

---

## 3. 投影矩陣的性質

### 投影到直線的矩陣

```
P = aaᵀ/(aᵀa)
```

這是一個 **n×n 矩陣**，把任何向量投影到 a 的方向。

### 核心性質

| 性質 | 公式 | 意義 |
|------|------|------|
| 對稱性 | Pᵀ = P | 投影矩陣是對稱的 |
| 冪等性 | P² = P | 投影兩次等於投影一次 |
| 秩 | rank(P) = 1 | 投影到一維子空間 |

### 冪等性證明

```
P² = (aaᵀ/(aᵀa)) × (aaᵀ/(aᵀa))
   = aaᵀaaᵀ/(aᵀa)²
   = a(aᵀa)aᵀ/(aᵀa)²
   = aaᵀ/(aᵀa)
   = P ✓
```

### 例子

```
a = [1, 2]ᵀ

P = aaᵀ/(aᵀa) = [1][1 2]/(1² + 2²)
                [2]
              = [1 2] / 5
                [2 4]
              = [0.2  0.4]
                [0.4  0.8]

驗證 P² = P：
P² = [0.2  0.4] [0.2  0.4]   [0.2  0.4]
     [0.4  0.8] [0.4  0.8] = [0.4  0.8] = P ✓
```

---

## 4. 投影到子空間

### 問題

給定 m×n 矩陣 A（行向量張成子空間），求向量 b 在 C(A) 上的投影。

### 推導

投影 p = Ax̂ 在 C(A) 中。

誤差 e = b - Ax̂ 必須垂直於 C(A) 的每一個向量：
```
Aᵀ(b - Ax̂) = 0
Aᵀb - AᵀAx̂ = 0
AᵀAx̂ = Aᵀb     ← 正規方程 (Normal Equation)
```

### 投影公式

```
係數：x̂ = (AᵀA)⁻¹Aᵀb

投影：p = Ax̂ = A(AᵀA)⁻¹Aᵀb

投影矩陣：P = A(AᵀA)⁻¹Aᵀ
```

**注意**：AᵀA 必須可逆，這要求 A 的行向量線性獨立。

### 投影矩陣性質（通用版）

```
Pᵀ = P    （對稱）
P² = P    （冪等）
rank(P) = rank(A)
```

---

## 5. 幾何意義

### 正交分解

任何向量 b ∈ ℝᵐ 可分解為：

```
b = p + e

其中：
  p ∈ C(A)     （投影，在行空間中）
  e ∈ C(A)⊥    （誤差，在行空間的正交補中）
```

### 最近點

p 是 C(A) 中離 b 最近的點：

```
‖b - p‖ ≤ ‖b - v‖  對所有 v ∈ C(A)
```

---

## 6. 投影到正交基底

### 簡化情況

如果 A 的行向量 {a₁, a₂, ..., aₙ} 是**正交的**：

```
AᵀA = [‖a₁‖²           ]
      [     ‖a₂‖²      ]
      [          ⋱     ]
      [           ‖aₙ‖²]
```

是對角矩陣！

### 投影公式簡化

```
p = Σᵢ proj_{aᵢ}(b) = Σᵢ (aᵢᵀb/aᵢᵀaᵢ) aᵢ
```

投影 = 各正交分量的投影之和

### 標準正交基底更簡單

如果是**標準正交**基底（orthonormal）：

```
AᵀA = I

P = A(AᵀA)⁻¹Aᵀ = AAᵀ
```

---

## 7. 完整範例

### 投影到平面

給定平面的兩個基向量和要投影的向量：

```
    [1]       [0]       [1]
a₁ =[0]  a₂ =[1]   b = [2]
    [0]       [0]       [3]

A = [1 0]
    [0 1]
    [0 0]
```

計算：
```
AᵀA = [1 0 0] [1 0]   [1 0]
      [0 1 0] [0 1] = [0 1]
              [0 0]

(AᵀA)⁻¹ = [1 0]
          [0 1]

Aᵀb = [1 0 0] [1]   [1]
      [0 1 0] [2] = [2]
              [3]

x̂ = (AᵀA)⁻¹Aᵀb = [1]
                  [2]

p = Ax̂ = [1 0] [1]   [1]
         [0 1] [2] = [2]
         [0 0]       [0]
```

驗證：
```
e = b - p = [0]
            [0]
            [3]

Aᵀe = [1 0 0] [0]   [0]
      [0 1 0] [0] = [0] ✓ (e ⊥ C(A))
              [3]
```

---

## 8. 誤差的性質

### 誤差向量

```
e = b - p = b - Pb = (I - P)b
```

### I - P 也是投影矩陣

投影到 C(A) 的正交補 C(A)⊥：

```
(I - P)ᵀ = I - Pᵀ = I - P  （對稱）
(I - P)² = I - 2P + P² = I - 2P + P = I - P  （冪等）
```

---

## 9. 程式實作

### 本單元程式示範

| 檔案 | 內容 |
|------|------|
| `projection_manual.py` | 手刻投影公式 |
| `projection_numpy.py` | 使用 NumPy 實作 |

---

## 10. 考試重點

### 常見題型

1. **計算投影到直線**
2. **計算投影矩陣並驗證性質**
3. **投影到子空間**
4. **證明投影矩陣的對稱性和冪等性**
5. **找誤差向量並驗證正交性**

### 必背公式

```
投影到向量 a：
  p = (aᵀb/aᵀa) a
  P = aaᵀ/(aᵀa)

投影到子空間 C(A)：
  p = A(AᵀA)⁻¹Aᵀb
  P = A(AᵀA)⁻¹Aᵀ

投影矩陣性質：
  Pᵀ = P
  P² = P
```

### 常見錯誤

- 混淆 aaᵀ（矩陣）和 aᵀa（純量）
- 忘記檢查 AᵀA 是否可逆
- 在正規方程中 Aᵀ 要放對位置

---

## 參考資料

- Strang, Chapter 4.2: Projections
- MIT 18.06 Lecture 15
- 3Blue1Brown: Dot products and duality
